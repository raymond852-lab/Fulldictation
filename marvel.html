<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.H.I.E.L.D. Dictation Prep</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        :root {
            --im-red: #e62429; --im-gold: #ffd700;
            --cap-blue: #0047ab; --cap-white: #ffffff;
            --bg: #0b0e14;
        }

        body {
            font-family: 'Orbitron', 'Noto Sans TC', sans-serif;
            background: var(--bg); color: white; margin: 0; padding: 10px;
            text-align: center;
        }

        /* Hero HUD */
        .hero-selector { margin: 15px 0; display: flex; justify-content: center; gap: 10px; }
        .h-btn { 
            border: 2px solid rgba(255,255,255,0.2); background: #1a1a1a; 
            padding: 10px; border-radius: 12px; cursor: pointer; transition: 0.3s;
        }
        .h-btn.active-im { border-color: var(--im-gold); background: var(--im-red); }
        .h-btn.active-cap { border-color: white; background: var(--cap-blue); }
        .h-btn img { width: 50px; height: 50px; display: block; }

        /* Paragraph Layout */
        .mission-board {
            background: rgba(20, 30, 45, 0.9); border: 2px solid #333;
            padding: 20px; border-radius: 15px; max-width: 900px; margin: 0 auto;
            text-align: left; line-height: 2.2;
        }

        .word-unit {
            display: inline-flex; flex-direction: column; align-items: center;
            vertical-align: middle; margin: 5px;
        }

        .char-tile {
            width: 55px; height: 55px; line-height: 55px; text-align: center;
            font-size: 1.8rem; background: #000; border: 1px solid #444;
            border-radius: 8px; cursor: pointer; color: transparent; /* Hidden for memory */
            transition: all 0.3s; position: relative;
        }
        .char-tile.revealed { color: #fff; border-color: var(--im-gold); }
        .char-tile.mastered { border-color: #00ff00; background: rgba(0,255,0,0.1); }

        .star-count { font-size: 10px; color: #ffd700; height: 12px; }

        /* Training Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100; justify-content: center; align-items: center;
        }
        .modal-box {
            background: #111; border: 3px solid #444; padding: 20px;
            border-radius: 20px; width: 340px; text-align: center;
        }

        #writer-canvas {
            background: white; margin: 15px auto; border-radius: 10px;
            width: 250px; height: 250px;
        }

        .mode-btn {
            width: 100%; margin: 5px 0; padding: 12px; border: none;
            border-radius: 8px; font-family: 'Orbitron'; cursor: pointer; font-weight: bold;
        }
        .guide-btn { background: #eee; color: #333; }
        .ghost-btn { background: #ff00ff; color: #fff; box-shadow: 0 0 10px #ff00ff; }

        .punc { color: #666; font-size: 1.5rem; margin: 0 5px; vertical-align: middle; }
    </style>
</head>
<body>

    <div class="hero-selector">
        <div id="btn-im" class="h-btn active-im" onclick="switchHero('im')">
            <img src="https://cdn-icons-png.flaticon.com/512/6295/6295417.png">
            <span style="font-size:10px; color:white;">TONY</span>
        </div>
        <div id="btn-cap" class="h-btn" onclick="switchHero('cap')">
            <img src="https://cdn-icons-png.flaticon.com/512/6295/6295403.png">
            <span style="font-size:10px; color:white;">STEVE</span>
        </div>
    </div>

    <h2 id="msg-brief" style="color:var(--im-gold); margin-bottom:5px;">MISSION BRIEFING</h2>
    <p style="font-size:0.8rem; margin-bottom:20px;">Tap a data block to analyze. Use GHOST MODE to master the word for dictation.</p>

    <div class="mission-board" id="board"></div>

    <div id="practice-modal" class="modal">
        <div class="modal-box" id="modal-frame">
            <h3 id="practice-title" style="margin:0; color:var(--im-gold);">ANALYZING...</h3>
            <div id="writer-canvas"></div>
            <button class="mode-btn guide-btn" onclick="runQuiz(true)">‚úçÔ∏è LV1: TRACE GUIDE</button>
            <button class="mode-btn ghost-btn" onclick="runQuiz(false)">üß† LV2: GHOST MODE (MEMORY)</button>
            <p id="hint-text" style="font-size:0.7rem; color:#888; margin-top:10px;">Ghost mode hides the lines. Can you remember it?</p>
            <button onclick="closeModal()" style="background:transparent; color:#666; border:none; margin-top:10px; cursor:pointer;">[ CANCEL MISSION ]</button>
        </div>
    </div>

    <script>
        const paragraph = "ÂïäÔºåÊàëÁµÇÊñºÊâæÂà∞‰∏ÄÁâáÊúÄÊºÇ‰∫ÆÁöÑÊ®πËëâ‰∫ÜÔºÅÂÆÉÂÉè‰∏ÄÈ°ÜÂøÉÔºåÂèàÂÉèËÄÅÂ∏´ÁöÑÁ¨ëËáâ„ÄÇÊàëÊääÊ®πËëâË≤ºÂú®‰∏ÄÂºµÁ¥ô‰∏äÔºåÂÜçÂØ´‰∏äÁ•ùÁ¶èÔºåÂÅöÊàê‰∏ÄÂºµÊÑüË¨ùÂç°ÔºåÈÄÅÁµ¶ÊàëÊúÄÊÑõÁöÑËÄÅÂ∏´„ÄÇ";
        let currentHero = 'im';
        let writer = null;
        let activeChar = '';
        let activeTile = null;

        function switchHero(type) {
            currentHero = type;
            document.getElementById('btn-im').className = type === 'im' ? 'h-btn active-im' : 'h-btn';
            document.getElementById('btn-cap').className = type === 'cap' ? 'h-btn active-cap' : 'h-btn';
            document.getElementById('msg-brief').style.color = type === 'im' ? 'var(--im-gold)' : '#fff';
            document.getElementById('practice-title').style.color = type === 'im' ? 'var(--im-gold)' : 'var(--cap-blue)';
            document.getElementById('modal-frame').style.borderColor = type === 'im' ? 'var(--im-red)' : 'var(--cap-blue)';
        }

        function initBoard() {
            const board = document.getElementById('board');
            paragraph.split('').forEach((char, idx) => {
                if (/[Ôºå„ÄÇÔºÅ„ÄÅ]/.test(char)) {
                    const s = document.createElement('span');
                    s.className = 'punc';
                    s.innerText = char;
                    board.appendChild(s);
                } else {
                    const unit = document.createElement('div');
                    unit.className = 'word-unit';
                    
                    const starDiv = document.createElement('div');
                    starDiv.className = 'star-count';
                    starDiv.id = `stars-${idx}`;
                    
                    const tile = document.createElement('div');
                    tile.className = 'char-tile';
                    tile.innerText = char;
                    tile.onclick = () => handleTileClick(tile, char, idx);
                    
                    unit.appendChild(starDiv);
                    unit.appendChild(tile);
                    board.appendChild(unit);
                }
            });
        }

        function handleTileClick(tile, char, idx) {
            if (!tile.classList.contains('revealed')) {
                tile.classList.add('revealed');
            } else {
                openPractice(char, tile, idx);
            }
        }

        function openPractice(char, tile, idx) {
            activeChar = char;
            activeTile = tile;
            document.getElementById('practice-modal').style.display = 'flex';
            document.getElementById('writer-canvas').innerHTML = '';
            
            writer = HanziWriter.create('writer-canvas', char, {
                width: 250, height: 250, padding: 15,
                strokeColor: '#202020',
                radicalColor: currentHero === 'im' ? '#e62429' : '#0047ab',
                drawingWidth: 25,
                showOutline: true
            });
            writer.animateCharacter();
        }

        function runQuiz(isGuide) {
            if (!isGuide) {
                writer.hideOutline();
                document.getElementById('hint-text').innerText = "SYSTEM OFFLINE: USE YOUR BRAIN!";
            } else {
                writer.showOutline();
                document.getElementById('hint-text').innerText = "Follow the lights, kid.";
            }

            writer.quiz({
                onComplete: (summary) => {
                    if (!isGuide && summary.totalMistakes < 3) {
                        activeTile.classList.add('mastered');
                        const starId = activeTile.id.replace('tile','stars');
                        activeTile.parentElement.querySelector('.star-count').innerText = "‚≠ê‚≠ê‚≠êüèÜ";
                        alert(currentHero === 'im' ? "Tony: Data uploaded to memory. Perfect!" : "Cap: I knew you could do it, Soldier!");
                    } else if (isGuide) {
                        activeTile.parentElement.querySelector('.star-count').innerText = "‚≠ê";
                    }
                    setTimeout(closeModal, 500);
                }
            });
        }

        function closeModal() { document.getElementById('practice-modal').style.display = 'none'; }

        initBoard();
    </script>
</body>
</html>
